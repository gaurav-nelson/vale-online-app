<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Use Vale-at-Red-Hat online" />
    <meta name="author" content="Gaurav Nelson" />
    <title>Vale-at-Red-Hat online</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://code.getmdl.io/1.3.0/material.indigo-green.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"
    />
    <link rel="stylesheet" type="text/css" href="./css/app.css" />
    <link rel="shortcut icon" href="./favicon.ico" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.2/codemirror.min.css"
      integrity="sha512-xIf9AdJauwKIVtrVRZ0i4nHP61Ogx9fSRAkCLecmE2dL/U8ioWpDvFCAy4dcfecN72HHB9+7FfQj3aiO68aaaw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/codemirror@5.62.2/theme/material.css"
      integrity="sha256-zlIm5LpxT75HH4hqk0U/3lCJYJVCT5fNRypHPYKp9ik="
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header id="mainHeader" class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <a href="https://github.com/gaurav-nelson/vale-online-app" target="_blank" class="app-branding">
            <img src="./github-mark-white.svg" alt="GitHub" class="github-icon-left">
            <span id="appHeader" class="mdl-layout-title">Vale-at-Red-Hat online</span>
          </a>
          <div class="mode-toggle-container mode-toggle-left">
            <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="mode-toggle-switch">
              <input type="checkbox" id="mode-toggle-switch" class="mdl-switch__input" onchange="toggleValeMode()">
              <span class="mdl-switch__label mode-toggle-label">DITA mode</span>
            </label>
          </div>
          <div class="mdl-layout-spacer"></div>
          <nav class="mdl-navigation">
            <button
              id="theme-toggle-button"
              class="mdl-button mdl-js-button mdl-button--icon mdl-button--accent buttonMargin"
              onclick="changeTheme()"
            >
              <i id="theme-toggle-icon" class="material-icons">dark_mode</i>
            </button>
            <button
              id="clear-button"
              onclick="clearEditor()"
              class="mdl-button mdl-js-button mdl-button--accent mdl-js-ripple-effect buttonMargin"
            >
              Clear
            </button>
            <button
              id="lint-button"
              onclick="runValeLint()"
              class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent buttonMargin"
            >
              Lint
            </button>
            <button
              id="ai-fix-button"
              onclick="showAIFixModal()"
              class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect ai-fix-btn mdl-button--accent"
              style="display: none;"
            >
              Fix issues with AI
            </button>
            <button
              id="convert-to-dita-button"
              onclick="openConvertToDitaModal()"
              class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored buttonMargin"
              style="display: none;"
            >
              Convert to DITA
            </button>
            <button
              id="settings-button"
              onclick="openSettingsModal()"
              class="mdl-button mdl-js-button mdl-button--icon mdl-button--accent"
            >
              <i class="material-icons">settings</i>
            </button>
          </nav>
        </div>
      </header>
      <main
        class="mdl-layout__content"
        ondrop="dropHandler(event);"
        ondragover="dragOverHandler(event);"
      >
        <div class="mdl-grid">
          <div class="mdl-cell mdl-cell--11-col" id="editor"></div>
          <div class="mdl-cell mdl-cell--1-col" id="results">
            <span class="mdl-chip mdl-chip--contact" id="warningChip">
              <span
                id="warningCount"
                class="mdl-chip__contact mdl-color--yellow-700"
                >0</span
              >
              <span class="mdl-chip__text">Warnings</span>
            </span>
            <span class="mdl-chip mdl-chip--contact" id="errorChip">
              <span id="errorCount" class="mdl-chip__contact mdl-color--red-600"
                >0</span
              >
              <span class="mdl-chip__text">Errors</span>
            </span>
            <span class="mdl-chip mdl-chip--contact" id="suggestionChip">
              <span
                id="suggestionCount"
                class="mdl-chip__contact mdl-color--blue-600"
                >0</span
              >
              <span class="mdl-chip__text">Suggestions</span>
            </span>
          </div>
        </div>
        <div id="cover"></div>
        <div id="spinner" class="centered">
          <div class="mdl-spinner mdl-js-spinner is-active"></div>
        </div>
        <div
          id="notification-msg"
          aria-live="assertive"
          aria-atomic="true"
          aria-relevant="text"
          class="mdl-snackbar mdl-js-snackbar"
        >
          <div class="mdl-snackbar__text"></div>
          <button type="button" class="mdl-snackbar__action"></button>
        </div>
      </main>
    </div>
    
    <!-- AI Fix Modal -->
    <div id="ai-fix-modal" class="ai-modal" style="display: none;">
      <div class="ai-modal-content">
        <div class="ai-modal-header">
          <h4>Fix Issues with AI</h4>
          <button class="ai-modal-close" onclick="closeAIFixModal()">&times;</button>
        </div>
        <div class="ai-modal-body">
          <!-- Issue Selection View -->
          <div id="issue-selection-view">
            <div class="ai-modal-actions">
              <div class="filter-dropdown-container">
                <label for="issue-filter-select" class="filter-label">Select:</label>
                <select id="issue-filter-select" class="filter-select" onchange="applyIssueFilter(this.value)">
                  <option value="all">All</option>
                  <option value="none" selected>None</option>
                  <option value="errors">Errors</option>
                  <option value="warnings">Warnings</option>
                  <option value="suggestions">Suggestions</option>
                </select>
              </div>
            </div>
            <div id="issues-list" class="issues-list"></div>
          </div>
          
          <!-- Approval View -->
          <div id="approval-view" style="display: none;">
            <div class="approval-progress">
              <p id="approval-progress-text">Processing issue 1 of 5...</p>
            </div>
            <div class="approval-issue-details">
              <span id="approval-severity" class="issue-severity"></span>
              <span id="approval-line" class="issue-line"></span>
              <div id="approval-check" class="issue-check"></div>
              <div id="approval-message" class="issue-message"></div>
            </div>
            <div class="fix-options-container">
              <div class="fix-option-row">
                <label for="approval-model-select" class="fix-option-label">Change model:</label>
                <select id="approval-model-select" class="fix-model-select"></select>
              </div>
              <div class="fix-option-row">
                <label class="fix-option-checkbox">
                  <input type="checkbox" id="add-context-checkbox">
                  <span>Add context</span>
                </label>
              </div>
              <div id="context-input-container" class="context-input-container" style="display: none;">
                <textarea 
                  id="context-textarea" 
                  class="context-textarea" 
                  placeholder="Provide additional context to help the AI improve the fix (e.g., 'Use British English spelling', 'Keep the technical terminology', etc.)..."
                  rows="3"
                ></textarea>
              </div>
            </div>
            <div class="approval-comparison">
              <div class="comparison-column">
                <h5>Original Text</h5>
                <div id="approval-original-text" class="comparison-text comparison-text-readonly"></div>
              </div>
              <div class="comparison-column">
                <h5>AI Suggested Fix (editable)</h5>
                <div id="approval-fixed-text" class="comparison-text comparison-text-editable" contenteditable="true" spellcheck="false"></div>
              </div>
            </div>
            <div class="approval-actions">
              <button onclick="approveCurrentFix()" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect approval-btn-approve">
                Approve
              </button>
              <button onclick="skipCurrentFix()" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect approval-btn-skip">
                Skip
              </button>
              <button onclick="retryCurrentFix()" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect approval-btn-retry">
                Retry
              </button>
              <button onclick="backToIssueList()" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                Back to List
              </button>
            </div>
          </div>
          
          <!-- Loading View -->
          <div id="ai-fix-loading" class="ai-fix-loading" style="display: none;">
            <div class="mdl-spinner mdl-js-spinner is-active"></div>
            <p id="ai-fix-status">Processing issues...</p>
          </div>
          
          <!-- Completion Summary View -->
          <div id="completion-summary" style="display: none;">
            <h4>All Issues Processed</h4>
            <div class="summary-stats">
              <p><strong>Approved:</strong> <span id="summary-approved">0</span></p>
              <p><strong>Skipped:</strong> <span id="summary-skipped">0</span></p>
              <p><strong>Failed:</strong> <span id="summary-failed">0</span></p>
            </div>
            <p id="summary-message">Click "Apply Changes" to update your text with the approved fixes.</p>
          </div>
        </div>
        <div class="ai-modal-footer">
          <button onclick="closeAIFixModal()" id="modal-cancel-btn" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
            Cancel
          </button>
          <button onclick="fixSelectedIssues()" id="fix-issues-btn" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">
            Fix Selected Issues
          </button>
          <button onclick="applyApprovedFixes()" id="apply-fixes-btn" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect" style="display: none;">
            Apply Changes
          </button>
        </div>
      </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="ai-modal" style="display: none;">
      <div class="ai-modal-content settings-modal-content">
        <div class="ai-modal-header">
          <h4>Settings</h4>
          <button class="ai-modal-close" onclick="closeSettingsModal()">&times;</button>
        </div>
        <div class="ai-modal-body">
          <div class="settings-option">
            <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="suggestionsCheckbox">
              <input
                type="checkbox"
                id="suggestionsCheckbox"
                onclick="showHideSuggestions(this)"
                class="mdl-checkbox__input"
              />
              <span class="mdl-checkbox__label">Show suggestions</span>
            </label>
          </div>
          <div class="settings-option" id="model-selection-container" style="display: none;">
            <label for="ollamaModelSelect" class="settings-label">OllamaAI Model</label>
            <select id="ollamaModelSelect" class="model-select" onchange="saveSelectedModel(this)">
              <option value="">Loading models...</option>
            </select>
          </div>
          
          <!-- DITA Conversion Settings (only visible in DITA mode) -->
          <div id="dita-settings-container" style="display: none;">
            <div class="settings-separator"></div>
            <h5 class="settings-section-title">DITA Conversion Options</h5>
            <div class="settings-option">
              <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="ditaAutoSpecializeCheckbox">
                <input
                  type="checkbox"
                  id="ditaAutoSpecializeCheckbox"
                  class="mdl-checkbox__input"
                  onchange="saveDitaSetting('autoSpecialize', this.checked)"
                />
                <span class="mdl-checkbox__label">Auto-convert to specialized DITA</span>
              </label>
              <p class="settings-hint">Automatically detect type and convert to specialized DITA</p>
            </div>
            <div class="settings-option">
              <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="ditaAutoCleanupCheckbox">
                <input
                  type="checkbox"
                  id="ditaAutoCleanupCheckbox"
                  class="mdl-checkbox__input"
                  onchange="saveDitaSetting('autoCleanup', this.checked)"
                />
                <span class="mdl-checkbox__label">Auto-cleanup DITA</span>
              </label>
              <p class="settings-hint">Automatically clean up DITA files after conversion</p>
            </div>
            <div class="settings-separator"></div>
            <div class="settings-option">
              <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="ditaEnableAuthorsCheckbox">
                <input
                  type="checkbox"
                  id="ditaEnableAuthorsCheckbox"
                  class="mdl-checkbox__input"
                  onchange="saveDitaSetting('enableAuthors', this.checked)"
                />
                <span class="mdl-checkbox__label">Enable author lines</span>
              </label>
              <p class="settings-hint">Process author lines as metadata instead of paragraphs</p>
            </div>
            <div class="settings-option">
              <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="ditaDisableFloatingTitlesCheckbox">
                <input
                  type="checkbox"
                  id="ditaDisableFloatingTitlesCheckbox"
                  class="mdl-checkbox__input"
                  onchange="saveDitaSetting('disableFloatingTitles', this.checked)"
                />
                <span class="mdl-checkbox__label">Disable floating titles</span>
              </label>
              <p class="settings-hint">Don't convert floating titles (may lose content)</p>
            </div>
            <div class="settings-option">
              <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="ditaDisableCalloutsCheckbox">
                <input
                  type="checkbox"
                  id="ditaDisableCalloutsCheckbox"
                  class="mdl-checkbox__input"
                  onchange="saveDitaSetting('disableCallouts', this.checked)"
                />
                <span class="mdl-checkbox__label">Disable callouts</span>
              </label>
              <p class="settings-hint">Don't convert callout annotations (may lose content)</p>
            </div>
            <div class="settings-option">
              <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="ditaSecureModeCheckbox">
                <input
                  type="checkbox"
                  id="ditaSecureModeCheckbox"
                  class="mdl-checkbox__input"
                  onchange="saveDitaSetting('secureMode', this.checked)"
                />
                <span class="mdl-checkbox__label">Secure mode (disable includes)</span>
              </label>
              <p class="settings-hint">Only convert the current file, don't resolve include directives</p>
            </div>
          </div>
        </div>
        <div class="ai-modal-footer">
          <button onclick="closeSettingsModal()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">
            Close
          </button>
        </div>
      </div>
    </div>
    
    <!-- DITA Conversion Modal -->
    <div id="dita-conversion-modal" class="ai-modal" style="display: none;">
      <div class="ai-modal-content dita-modal-content">
        <div class="ai-modal-header">
          <div style="display: flex; align-items: center; gap: 12px;">
            <h4>DITA Conversion Result</h4>
            <span id="dita-type-badge" class="dita-type-badge" style="display: none;"></span>
          </div>
          <button class="ai-modal-close" onclick="closeDitaModal()">&times;</button>
        </div>
        <div class="ai-modal-body">
          <div id="dita-loading" class="ai-fix-loading" style="display: none;">
            <div class="mdl-spinner mdl-js-spinner is-active"></div>
            <p>Converting AsciiDoc to DITA...</p>
          </div>
          <div id="dita-error" class="dita-error" style="display: none;">
            <p id="dita-error-message"></p>
          </div>
          <div id="dita-output-container" style="display: none;">
            <div class="dita-output-actions">
              <button onclick="copyDitaToClipboard()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent mdl-js-ripple-effect">
                <i class="material-icons" style="vertical-align: middle; margin-right: 4px;">content_copy</i>
                Copy to Clipboard
              </button>
              <button onclick="downloadDitaFile()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent mdl-js-ripple-effect">
                <i class="material-icons" style="vertical-align: middle; margin-right: 4px;">download</i>
                Download DITA File
              </button>
            </div>
            <div id="dita-output" class="dita-output"></div>
          </div>
          <!-- Generic DITA view with specialization buttons -->
          <div id="dita-specialization-view" style="display: none;">
            <div class="dita-output-actions">
              <button onclick="copyDitaToClipboard()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent mdl-js-ripple-effect">
                <i class="material-icons" style="vertical-align: middle; margin-right: 4px;">content_copy</i>
                Copy to Clipboard
              </button>
              <button onclick="downloadDitaFile()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent mdl-js-ripple-effect">
                <i class="material-icons" style="vertical-align: middle; margin-right: 4px;">download</i>
                Download Generic DITA
              </button>
            </div>
            <div id="dita-generic-output" class="dita-output"></div>
            <div class="dita-specialization-actions">
              <p style="margin-top: 20px; margin-bottom: 10px; font-weight: 500; font-size: 1rem;">Convert to specialized DITA:</p>
              <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="handleSpecializationClick('concept')" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">
                  Convert to Concept
                </button>
                <button onclick="handleSpecializationClick('reference')" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">
                  Convert to Reference
                </button>
                <button onclick="handleSpecializationClick('task')" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">
                  Convert to Task
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="ai-modal-footer">
          <button onclick="closeDitaModal()" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">
            Close
          </button>
        </div>
      </div>
    </div>
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.20/codemirror.min.js" integrity="sha512-hJEMjfR4ds7mXbBot3i/R+CsiyYpeWSezXul8uLBT8wXAHPUdhRgl4LLTtMGwjarftGKiQqK1v20XScm0ANTPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/codemirror-asciidoc@1.0.4/lib/asciidoc.min.js"
    ></script>
    <script type="text/javascript" src="./js/placeholder.js"></script>
    <script type="text/javascript" src="./js/editor-init.js"></script>
    <script type="text/javascript" src="./js/vale-core.js"></script>
    <script type="text/javascript" src="./js/results-display.js"></script>
    <script type="text/javascript" src="./js/theme-manager.js"></script>
    <script type="text/javascript" src="./js/file-handlers.js"></script>
    <script type="text/javascript" src="./js/ui-helpers.js"></script>
    <script type="text/javascript" src="./js/ollama-integration.js"></script>
    <script type="text/javascript" src="./js/ai-fix-modal.js"></script>
    <script type="text/javascript" src="./js/ai-fix-workflow.js"></script>
    <script type="text/javascript" src="./js/mode-manager.js"></script>
  </body>
</html>
